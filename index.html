<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fire of Life — Диагностика</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Italiana&family=Manrope:wght@200;300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* FONTS - Пути изменены на папку fonts */
        @font-face {
            font-family: 'Vela Sans';
            src: url('./fonts/VelaSans-Regular.woff2') format('woff2');
            font-weight: 400;
        }
        @font-face {
            font-family: 'Vela Sans';
            src: url('./fonts/VelaSans-Bold.woff2') format('woff2');
            font-weight: 700;
        }

        body { 
            font-family: 'Vela Sans', 'Manrope', sans-serif;
            margin: 0; padding: 0; background-color: #0f0e17; overflow: hidden; 
            -webkit-tap-highlight-color: transparent;
        }
        
        h1, h2, h3, h4, .serif { font-family: 'Cormorant Garamond', serif; letter-spacing: 0.02em; }
        .elegant { font-family: 'Italiana', serif; }
        
        /* Умный перенос текста */
        .text-pretty { text-wrap: pretty; }
        .text-balance { text-wrap: balance; }
        
        /* Центрирование и масштаб мандал внутри круга */
        .img-center-scale {
            object-fit: cover;
            object-position: center center;
            transform: scale(1.28); /* Изначально делаем узор крупнее, обрезая пустой фон */
            transition: transform 8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .mandala-container:hover .img-center-scale {
            transform: scale(1.4); /* Плавное увеличение при наведении */
        }
        
        /* Animations */
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        /* Усиленный зум для финальной мандалы: стартует крупным (1.28) и плавно растет (1.38) */
        @keyframes zoom-slow { from { transform: scale(1.28); } to { transform: scale(1.38); } }
        @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.12); opacity: 1; } }
        
        /* Медленные, изящные кинематографичные искры с покачиванием по оси X */
        @keyframes magical-spark {
            0% { transform: translateY(110vh) translateX(0) scale(0.5); opacity: 0; }
            15% { opacity: var(--maxOpacity); }
            50% { transform: translateY(40vh) translateX(var(--sway1)) scale(1.1); }
            85% { opacity: var(--maxOpacity); }
            100% { transform: translateY(-20vh) translateX(var(--sway2)) scale(0.5); opacity: 0; }
        }
        
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes spin-reverse { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }
        @keyframes pulse-glow { 
            0%, 100% { transform: scale(1); opacity: 0.2; } 
            50% { transform: scale(1.15); opacity: 0.45; } 
        }

        .animate-fade-in-up { animation: fade-in-up 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) both; }
        .animate-zoom { animation: zoom-slow 8s ease-in-out infinite alternate; }
        .animate-breathe { animation: breathe 5s ease-in-out infinite; }
        .animate-spin-slow { animation: spin-slow 20s linear infinite; }
        .animate-spin-reverse { animation: spin-reverse 25s linear infinite; }
        .animate-pulse-glow { animation: pulse-glow 4s ease-in-out infinite; }
        
        .glass-card { backdrop-filter: blur(20px); transition: all 0.3s ease; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }

        .mandala-container {
            position: relative; border-radius: 50%; overflow: hidden;
            transition: all 0.5s ease; cursor: pointer;
            border: 2px solid transparent;
        }
        .mandala-container:active { transform: scale(0.96); }

        .mandala-glow-light:hover {
            box-shadow: 0 0 40px rgba(158, 42, 43, 0.5);
            border-color: rgba(158, 42, 43, 0.6);
            transform: scale(1.02);
        }

        .mandala-glow-dark:hover {
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.5);
            border-color: rgba(212, 175, 55, 0.6);
            transform: scale(1.02);
        }

        .btn-primary { position: relative; overflow: hidden; transition: all 0.3s ease; }
        .btn-primary:active { transform: scale(0.98); }

        .logo-img { max-width: 220px; height: auto; object-fit: contain; }
        
        /* Базовый класс для частиц */
        .magical-spark {
            position: absolute;
            border-radius: 50%;
            mix-blend-mode: screen;
            animation: magical-spark linear infinite;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- УМНЫЙ ТИПОГРАФ ---
        // Функция привязывает короткие предлоги к следующему слову
        const formatText = (str) => {
            if (!str) return '';
            // Используем безопасный набор предлогов для исключения висячих строк
            return str.replace(/(^|\s)(в|без|до|для|за|через|над|по|из|у|около|под|о|про|на|к|перед|при|с|между|а|и|да|но|или|либо|что|как|если|то|же)\s/gi, '$1$2\u00A0');
        };

        // --- УМНЫЙ ЛОГОТИП (защита от ошибок регистра на сервере) ---
        const AppLogo = () => {
            const [errorCount, setErrorCount] = useState(0);
            const paths = [
                'images/logo.PNG',
                'images/logo.png',
                './images/logo.PNG',
                './images/logo.png'
            ];

            // Альтернативный вариант — показываем изящный текст
            if (errorCount >= paths.length) {
                return (
                    <h1 className="elegant text-4xl text-[#EADDCD] tracking-[0.3em] font-light text-center m-0 animate-fade-in-up" style={{ animationDelay: '0.2s' }}>
                        Fire of Life
                    </h1>
                );
            }

            return (
                <img 
                    src={paths[errorCount]} 
                    alt="Fire of Life" 
                    className="w-[220px] mx-auto block animate-fade-in-up" 
                    style={{ filter: 'drop-shadow(0 10px 15px rgba(0,0,0,0.5))', animationDelay: '0.2s' }}
                    onError={() => setErrorCount(prev => prev + 1)}
                />
            );
        };

        // --- КИНЕМАТОГРАФИЧНЫЕ ЧАСТИЦЫ ---
        const MagicalSparks = () => {
            return (
                <div className="absolute inset-0 overflow-hidden pointer-events-none z-0">
                    {[...Array(45)].map((_, i) => {
                        const isBokeh = i % 4 === 0;
                        const size = isBokeh ? (Math.random() * 5 + 3) : (Math.random() * 2 + 1);
                        const blur = isBokeh ? `${size / 2}px` : '0px';
                        const colors = ['#fde68a', '#fcd34d', '#fbbf24', '#f59e0b', '#ea580c'];
                        const color = colors[i % colors.length];
                        
                        return (
                            <div 
                                key={i} 
                                className="magical-spark" 
                                style={{ 
                                    left: `${Math.random() * 90 + 5}%`, /* Отступ от краев во избежание обрезки */
                                    width: `${size}px`, 
                                    height: `${size}px`, 
                                    backgroundColor: color,
                                    boxShadow: `0 0 ${isBokeh ? 12 : 5}px ${isBokeh ? 3 : 1}px ${color}`,
                                    filter: isBokeh ? `blur(${blur})` : 'none',
                                    '--sway1': `${Math.random() * 80 - 40}px`,
                                    '--sway2': `${Math.random() * 80 - 40}px`,
                                    '--maxOpacity': isBokeh ? (Math.random() * 0.3 + 0.1) : (Math.random() * 0.5 + 0.3),
                                    animationDuration: `${Math.random() * 25 + 20}s`, /* Очень изящно и медленно */
                                    animationDelay: `-${Math.random() * 45}s`
                                }} 
                            />
                        );
                    })}
                </div>
            );
        };

        // --- ICONS (SVG) ---
        const Icon = {
            Sun: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>),
            Moon: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>),
            ArrowLeft: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>),
            ArrowRight: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>),
            Heart: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>),
            Coins: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18.06"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></svg>),
            Rocket: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09Z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2Z"/><path d="M9 12H4s.5-1 1-4c2 0 5 2.5 5 2.5Z"/><path d="M12 15v5s1-.5 4-1c0-2-2.5-5-2.5-5Z"/></svg>),
            Flower: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 16.5c0-4.5 4.5-4.5 4.5-4.5s0-4.5-4.5-4.5-4.5 4.5-4.5 4.5 4.5 4.5 4.5 4.5Z"/><path d="M12 7.5c-4.5 0-4.5 4.5-4.5 4.5s4.5 0 4.5-4.5 4.5 4.5 4.5-4.5 0-4.5-4.5Z"/></svg>),
            Infinity: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z"/></svg>),
            Flame: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.5 4 6.5 2 2 3 5.5 3 8.5a7 7 0 1 1-14 0c0-3 2.5-6 4.5-8.5.5.75 1 1.25 1 2.5a2.5 2.5 0 0 1-2.5 2.5Z"/></svg>),
            Gift: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5C11 3 12 8 12 8s1-5 4.5-5a2.5 2.5 0 0 1 0 5H12Z"/></svg>),
            Sparkles: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3 1.912 5.813a2 2 0 0 0 1.275 1.275L21 12l-5.813 1.912a2 2 0 0 0-1.275 1.275L12 21l-1.912-5.813a2 2 0 0 0-1.275-1.275L3 12l5.813-1.912a2 2 0 0 0 1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M3 5h4"/><path d="M21 17v4"/><path d="M19 19h4"/></svg>),
            RotateCcw: (p) => (<svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>)
        };

        const THEMES = {
            dark: { id: 'dark', bg: '#1C1B22', bgGradient: 'linear-gradient(135deg, #1C1B22 0%, #2A2530 50%, #15141A 100%)', text: '#EADDCD', accent: '#D4AF37', secondary: '#A3998D', cardBg: 'rgba(28, 27, 34, 0.7)', cardBorder: 'rgba(212, 175, 55, 0.2)', buttonText: '#1C1B22', mandalaBg: 'rgba(212, 175, 55, 0.05)' },
            light: { id: 'light', bg: '#F9F7F2', bgGradient: 'linear-gradient(135deg, #F9F7F2 0%, #F2EFE9 50%, #F9F7F2 100%)', text: '#2D2A32', accent: '#9E2A2B', secondary: '#7A7269', cardBg: 'rgba(255, 255, 255, 0.75)', cardBorder: 'rgba(158, 42, 43, 0.15)', buttonText: '#ffffff', mandalaBg: 'rgba(158, 42, 43, 0.05)' }
        };

        // --- 1. SPHERES CONFIGURATION ---
        const SPHERES = [
            { id: 'love', title: 'Любовь и отношения', icon: Icon.Heart },
            { id: 'finance', title: 'Финансовое благополучие', icon: Icon.Coins },
            { id: 'realization', title: 'Реализация и проявленность', icon: Icon.Rocket },
            { id: 'health', title: 'Здоровье и восстановление', icon: Icon.Flower },
            { id: 'balance', title: 'Баланс и личная сила', icon: Icon.Infinity }
        ];

        // --- 2. MANDALAS DATABASE ---
        const STATES_DB = {
            dignity: { id: 'dignity', title: 'Достоинство', candle: 'Королева', link: 'https://t.me/vselennai_balansa/4', img: 'dignity' },
            sensuality: { id: 'sensuality', title: 'Чувственность', candle: 'Чувственность', link: 'https://t.me/vselennai_balansa/5', img: 'sensuality' },
            balance: { id: 'balance', title: 'Баланс', candle: 'Баланс', link: 'https://t.me/vselennai_balansa/6', img: 'balance' },
            support: { id: 'support', title: 'Опора', candle: 'Стабильность', link: 'https://t.me/vselennai_balansa/7', img: 'support' },
            relax: { id: 'relax', title: 'Расслабление', candle: 'Релакс', link: 'https://t.me/vselennai_balansa/8', img: 'relax' },
            movement: { id: 'movement', title: 'Движение', candle: 'Сафари', link: 'https://t.me/vselennai_balansa/9', img: 'movement' },
            freedom: { id: 'freedom', title: 'Свобода', candle: 'Свобода', link: 'https://t.me/vselennai_balansa/10', img: 'freedom' },
            clarity: { id: 'clarity', title: 'Ясность', candle: 'Ничего лишнего', link: 'https://t.me/vselennai_balansa/11', img: 'clarity' },
            passion: { id: 'passion', title: 'Страсть', candle: 'Ночь любви', link: 'https://t.me/vselennai_balansa/12', img: 'passion' }, 
            liberation: { id: 'liberation', title: 'Освобождение', candle: 'Стоп Негатив', link: 'https://t.me/vselennai_balansa/13', img: 'liberation' }
        };

        // --- 3. LOGIC ---
        // Идеальное визуальное распределение мандал для гармоничной сетки 3-2-3
        const getMandalasForSphere = (sphereId) => {
            if (sphereId === 'love') {
                return ['relax', 'dignity', 'clarity', 'balance', 'passion', 'sensuality', 'support', 'liberation'];
            }
            if (sphereId === 'balance') {
                return ['relax', 'dignity', 'freedom', 'balance', 'passion', 'sensuality', 'support', 'liberation'];
            }
            return ['relax', 'dignity', 'clarity', 'balance', 'movement', 'sensuality', 'support', 'liberation'];
        };

        // --- 4. TEXT MATRIX ---
        const CONTENT = {
            love: {
                dignity: "Сейчас в сфере любви тебе не хватает ощущения собственной ценности — неважно, ты в отношениях или в поиске.\n\nЕсли ты в паре, это может проявляться как согласие на меньшее, терпение вместо выбора, страх потерять вместо чувства «я достойна большего».\n\nЕсли ты в поиске, ты можешь притягивать мужчин, которые не готовы вкладываться, выбирать тебя полностью или признавать твою ценность.\n\nЭта мандала приходит, когда важно вернуть внутренний статус женщины, которая выбирает, а не ждёт, и чувствует свою ценность без доказательств.",
                sensuality: "Когда не хватает чувственности, любовь\u00A0уходит в\u00A0голову.\n\nОтношения становятся правильными, но\u00A0холодными.\n\nТело выключено, близость теряет живость и\u00A0притяжение.\n\nМандала говорит о том, что важно вернуться в тело, разрешить себе чувствовать, наслаждаться, быть живой. Именно из этого состояния женщина становится по-настоящему притягательной.",
                balance: "Сейчас в любви есть перекос.\n\nЕсли ты в отношениях, возможно, ты слишком много контролируешь, тащишь на себе, решаешь за двоих.\n\nЕсли ты в поиске, ты можешь действовать из стратегии «я сама», не оставляя места мужчине проявляться.\n\nЭта мандала приходит, когда важно сбалансировать женскую мягкость и мужское действие, контроль и доверие.",
                support: "Сейчас в любви не хватает внутренней устойчивости.\n\nЕсли ты в отношениях, это может проявляться как тревога, страх потерять, эмоциональные качели.\n\nЕсли ты в поиске, может быть ощущение нестабильности: то надежда, то разочарование, то усталость от ожидания.\n\nМандала говорит о необходимости вернуть опору внутрь — состояние «я есть», «я выдерживаю», «я не теряю себя».",
                relax: "Сейчас в сфере любви много напряжения.\n\nЕсли ты в отношениях, тело может быть закрытым, близость ощущаться как усилие или риск.\n\nЕсли ты в поиске, напряжение считывается мужчинами сразу — как ожидание, контроль или внутреннюю усталость.\n\nМандала приходит, когда важно отпустить контроль и позволить любви приходить легче.",
                liberation: "Сейчас прошлое всё ещё влияет на твою любовную сферу.\n\nЕсли ты в отношениях, старые обиды и незавершённые истории могут отравлять настоящее.\n\nЕсли ты в поиске, прошлые разочарования могут незаметно закрывать сердце.\n\nМандала говорит о необходимости завершения и освобождения пространства для нового.",
                passion: "Сейчас в любви не хватает огня.\n\nЕсли ты в отношениях, они могли стать формальными, без искры и живого интереса.\n\nЕсли ты в поиске, может не быть внутреннего отклика, желания, притяжения к жизни и мужчинам.\n\nЭта мандала приходит, когда важно разжечь интерес, страсть к жизни и готовность подпускать близко.",
                clarity: "Сейчас в любви не хватает ясности.\n\nЕсли ты в отношениях, ты можешь путаться в ожиданиях и не до конца понимать, чего хочешь.\n\nЕсли ты в поиске, выбор партнёра может идти из фантазий, а не из контакта с телом и интуицией.\n\nМандала говорит о необходимости убрать лишнее и услышать себя по-настоящему."
            },
            finance: {
                dignity: "Сейчас в теме денег тебе важно вернуть ощущение собственной ценности. Не «доказывать», не «заслуживать», не соглашаться на меньшее из страха потерять возможность.\n\nКогда в финансах не хватает достоинства, женщина занижает цену, боится просить больше, выбирает невыгодные условия.\n\nЭта мандала говорит о необходимости встать в позицию внутренней Королевы — той, которая знает себе цену и не торгуется с жизнью.",
                sensuality: "Деньги сейчас идут через удовольствие, тело и живость, а не через напряжение и борьбу.\n\nЕсли в финансах не хватает чувственности: всё делается «через надо», много усилий, мало радости, быстро приходит выгорание.\n\nЭта мандала напоминает: ты — женщина, у которой многое получается легче, чем кажется. Когда ты возвращаешь контакт с телом и удовольствием от процесса, денежный поток становится мягче и стабильнее.",
                balance: "В деньгах сейчас слишком много контроля и стратегии «я сама».\n\nКогда баланс нарушен: ты всё держишь на себе, сложно доверять, деньги приходят ценой истощения, радость теряется.\n\nЭта мандала про необходимость соединить действие и доверие, планирование и интуицию. Деньги любят не только контроль, но и поток.",
                support: "Сейчас в финансах не хватает заземления и состояния «я здесь и сейчас».\n\nКогда нет опоры: много суеты, хаотичные действия, ощущение, что ты всё время спешишь, результат не соответствует усилиям.\n\nЭта мандала говорит: деньги приходят не от количества действий, а от точности и спокойствия. Когда ты замедляешься и действуешь из устойчивого состояния, всё начинает складываться органично.",
                relax: "Твоя нервная система сейчас перегружена, и это напрямую влияет на деньги.\n\nКогда много напряжения: решения принимаются из тревоги, сложно видеть возможности, появляются ошибки и откаты.\n\nЭта мандала про возвращение расслабления не только в тело, но и в голову. Расслабленная женщина — это женщина, которой жизнь начинает помогать через людей и обстоятельства.",
                liberation: "Прошлый опыт в деньгах всё ещё влияет на твои решения.\n\nЭто могут быть неудачи, разочарования, страх повторить прошлые ошибки.\n\nПока это внутри — рост блокируется. Эта мандала про то, чтобы отпустить прошлое, освободить место для нового финансового уровня.",
                movement: "Сейчас деньги ждут от тебя импульса и живого действия.\n\nЭто про внутренний огонёк, здоровую агрессию, умение не смиряться с обстоятельствами и готовность идти вперёд, а не выжидать.\n\nЭта мандала включает природную силу и смелость действовать. Не из напряжения, а из ощущения: я хочу больше и я могу.",
                clarity: "В деньгах сейчас много распыления и лишнего.\n\nКогда нет ясности: слишком много задач, нет приоритетов, энергия утекает, деньги теряются в хаосе.\n\nЭта мандала про фокус, связь с телом и умение отсекать лишнее. Про выбор действительно важного и способность делегировать, а не тащить всё на себе."
            },
            realization: {
                dignity: "В теме реализации тебе сейчас важно признать свою ценность и право быть видимой.\n\nКогда не хватает достоинства: женщина боится заявлять о себе, обесценивает опыт, сравнивает себя с другими, занижает масштаб.\n\nЭта мандала про внутреннюю позицию: «я имею право занимать место». Из этого состояния реализация становится устойчивой, а проявленность — естественной.",
                sensuality: "Твоя реализация сейчас нуждается в живости и удовольствии.\n\nКогда не хватает чувственности: работа превращается в обязанность, пропадает вкус, проекты выглядят «пустыми», энергия быстро заканчивается.\n\nЭта мандала напоминает: реализация женщины усиливается, когда она идёт через интерес, тело и удовольствие, а не только через усилие и дисциплину.",
                balance: "В реализации сейчас есть перекос. Это может быть чрезмерное действие и выгорание, или ожидание и застревание без движения.\n\nЭта мандала про соединение мужской структуры и женского потока, действий и доверия.\n\nКогда баланс возвращается, процессы начинают двигаться без насилия над собой.",
                support: "Твоей реализации сейчас не хватает устойчивости и системы.\n\nКогда нет опоры: идеи есть, но они не доводятся до результата, много начинаний, мало завершений.\n\nЭта мандала про заземление, регулярность и внутреннюю устойчивость. Реализация начинает расти, когда есть состояние «я стою, я выдерживаю, я иду шаг за шагом».",
                relax: "Напряжение сейчас блокирует твою проявленность.\n\nКогда нет расслабления: страшно ошибиться, сложно выходить в мир, креативность сжимается.\n\nЭта мандала про снятие внутреннего давления. В расслабленном состоянии проявленность становится живой, а жизнь начинает поддерживать через людей и обстоятельства.",
                liberation: "Прошлый опыт, неудачи или страхи всё ещё влияют на твою реализацию.\n\nЭто может быть страх повторить ошибку, стыд за прошлые попытки, внутренние запреты на рост.\n\nЭта мандала про освобождение от того, что удерживает тебя в старом масштабе, и разрешение себе новый уровень проявленности.",
                movement: "Тебе сейчас важно создать ускорение и импульс.\n\nЭто не про хаотичную активность, а про смелость действовать, здоровую агрессию и отказ от постоянного ожидания.\n\nЭта мандала пробуждает природную силу и внутренний драйв — перестать смиряться и начать идти вперёд.",
                clarity: "В реализации сейчас слишком много направлений и шума.\n\nКогда нет ясности: внимание распыляется, нет приоритетов, энергия уходит в суету.\n\nЭта мандала про фокус, выбор и концентрацию. Реализация усиливается, когда ты ясно видишь, что сейчас главное — а остальное можно убрать или отложить."
            },
            health: {
                dignity: "Женщина игнорирует сигналы тела.\n\nСтавит себя на последнее место.\n\nВосстановление откладывается.\n\nЭта мандала говорит о необходимости признать: ты — ценность, и твоё тело заслуживает внимания, бережности и регулярной поддержки.",
                sensuality: "Сейчас твоё здоровье напрямую связано с контактом с телом и ощущениями.\n\nКогда не хватает чувственности: тело воспринимается как инструмент, сигналы усталости игнорируются, пропадает удовольствие.\n\nЭта мандала приглашает вернуться в тело — слушать его, чувствовать, позволять себе мягкость.",
                balance: "В теме здоровья сейчас есть перекос — либо в сторону контроля, либо в сторону игнорирования.\n\nКогда баланса нет: женщина перегружает себя, не чувствует меры, живёт в режиме постоянного напряжения.\n\nЭта мандала про восстановление баланса между активностью и отдыхом, заботой и дисциплиной. Тело любит ритм.",
                support: "Твоему телу сейчас важно заземление и устойчивость.\n\nКогда нет опоры: много суеты, сбитый режим, ощущение, что ты всё время «на бегу», восстановление не происходит.\n\nЭта мандала про состояние «я здесь и сейчас», про регулярность, простые ритуалы заботы и спокойствие.",
                relax: "Твоё здоровье сейчас напрямую связано с уровнем напряжения в теле и голове.\n\nКогда расслабления не хватает: тело зажато, мысли не останавливаются, сон не восстанавливает.\n\nЭта мандала про поиск и разрешение на расслабление. Расслабленная женщина — это женщина, у которой тело начинает само включать процессы восстановления.",
                liberation: "В теле может храниться прошлый опыт, который до сих пор влияет на твоё состояние: стресс, эмоциональные перегрузки, подавленные чувства.\n\nПока это внутри — тело держит напряжение.\n\nЭта мандала про освобождение от того, что давно пора отпустить, чтобы здоровье перестало быть борьбой.",
                movement: "Твоему телу сейчас не хватает импульса и живости.\n\nЭто не про изнуряющие нагрузки, а про включённость, природное движение, ощущение силы и энергии в теле.\n\nЭта мандала пробуждает внутренний огонь, здоровую агрессию к жизни и желание двигаться вперёд, а не замирать.",
                clarity: "Твоё здоровье сейчас страдает от перегруженности и лишнего.\n\nКогда нет ясности: тело не успевает восстанавливаться, много стимулов, мало тишины и фокуса.\n\nЭта мандала про упрощение: понять, что действительно важно для твоего тела, а что можно убрать. Иногда здоровье возвращается не через добавление, а через убирание лишнего."
            },
            balance: {
                dignity: "Твоя личная сила сейчас требует возвращения ценности себя.\n\nКогда не хватает достоинства: женщина сомневается в себе, легко отказывается от желаемого, ставит других выше себя.\n\nЭта мандала про состояние: «я знаю, кто я, и мне не нужно это доказывать». Из этого состояния появляется спокойная, взрослая сила.",
                sensuality: "Твоя сила сейчас не в усилии, а в возвращении к своей женской природе.\n\nКогда не хватает чувственности: женщина живёт «через надо», всё делается тяжело, пропадает вкус к жизни.\n\nЭта мандала про умение быть в теле, в удовольствии, в мягкой силе.",
                balance: "Сейчас твоя личная сила перегружена мужскими стратегиями. Это состояние «я сама», контроль, постоянное напряжение.\n\nЖенщина много тянет, но мало чувствует.\n\nЭта мандала про соединение действия и доверия, структуры и потока. Баланс возвращает силу без выгорания.",
                support: "Твоя сила сейчас нуждается в заземлении.\n\nКогда нет опоры: много суеты, ощущение «я бегу, но не понимаю куда».\n\nЭта мандала про состояние «я здесь, я в теле, я в моменте». Из спокойной устойчивости решения становятся точнее, а действия — эффективнее.",
                relax: "Твоя личная сила сейчас зажата напряжением. Это может быть постоянный внутренний контроль, тревожные мысли, напряжение в теле.\n\nЭта мандала про умение отпускать.\n\nРасслабленная женщина — не слабая, а та, у которой энергия течёт свободно и жизнь начинает помогать.",
                liberation: "Часть твоей силы застряла в прошлом. Обиды, ожидания, нереализованные планы продолжают тянуть энергию назад.\n\nЭта мандала про закрытие старого и возврат энергии себе.\n\nКогда прошлое отпускается — сила возвращается в настоящее.",
                passion: "Твоя личная сила нуждается в оживлении.\n\nКогда нет огня: жизнь становится ровной, исчезает интерес, нет внутреннего «хочу».\n\nЭта мандала про страсть к жизни, к себе, к ощущениям. Огонь возвращает вкус, отклик и живость.",
                clarity: "Твоя сила распыляется. Слишком много мыслей, задач, ожиданий. Энергия уходит в суету.\n\nЭта мандала про фокус и приоритеты.\n\nКогда лишнее уходит, остаётся главное — и сила собирается в точке.",
                freedom: "Твоя личная сила готова к расширению. Это состояние «мне можно»: больше, по-другому, на новом уровне.\n\nЭта мандала работает с внутренними запретами, стыдом и потолками.\n\nСила растёт там, где появляется разрешение."
            }
        };

        // --- COMPONENTS ---

        const ScreenIntro = ({ onSelectTheme }) => {
            return (
                <div className="w-full h-full flex flex-col items-center justify-center p-8 text-center relative bg-[#0f0e17] overflow-hidden">
                <div className="absolute inset-0 bg-gradient-to-br from-[#1a1625] via-[#0f0e17] to-[#0a0a0f]"></div>
                
                {/* АНИМАЦИЯ ИСКР (ОГНЕННЫХ) */}
                <MagicalSparks />
                
                <div className="relative z-10 w-full flex flex-col items-center animate-fade-in-up">
                    
                    {/* ЛОГОТИП */}
                    <div className="mb-20 flex flex-col items-center gap-4">
                         <AppLogo />
                    </div>
                    
                    {/* АМУЛЕТЫ */}
                    <div className="flex justify-center items-center gap-10 w-full mb-16">
                        
                        {/* Амулет Солнца */}
                        <button onClick={() => onSelectTheme('light')} className="group relative w-32 h-32 rounded-full focus:outline-none flex items-center justify-center">
                            <div className="absolute inset-0 rounded-full bg-[#fcd34d] opacity-20 group-hover:opacity-40 blur-2xl transition-opacity duration-700"></div>
                            <div className="absolute inset-1 rounded-full border border-[#D4AF37]/40 border-dashed animate-spin-slow"></div>
                            
                            <div className="absolute inset-4 rounded-full bg-gradient-to-br from-[#fffbeb] via-[#fef3c7] to-[#fcd34d] shadow-[0_0_30px_rgba(251,191,36,0.3)] flex items-center justify-center overflow-hidden transition-transform duration-500 group-hover:scale-105">
                                <div className="absolute inset-0 bg-gradient-to-tr from-[#fbbf24]/50 to-transparent opacity-60"></div>
                                <Icon.Sun className="relative z-10 w-10 h-10 text-[#b45309] animate-spin-slow" />
                            </div>
                        </button>

                        {/* Амулет Луны */}
                        <button onClick={() => onSelectTheme('dark')} className="group relative w-32 h-32 rounded-full focus:outline-none flex items-center justify-center">
                            <div className="absolute inset-0 rounded-full bg-[#818cf8] opacity-10 group-hover:opacity-30 blur-2xl transition-opacity duration-700"></div>
                            <div className="absolute inset-1 rounded-full border border-[#c7d2fe]/30 border-dotted animate-spin-reverse"></div>
                            
                            <div className="absolute inset-4 rounded-full bg-gradient-to-br from-[#312e81] to-[#1e1b4b] shadow-[0_0_30px_rgba(129,140,248,0.2)] flex items-center justify-center overflow-hidden transition-transform duration-500 group-hover:scale-105">
                                <div className="absolute inset-0 bg-gradient-to-b from-black/40 to-transparent opacity-80"></div>
                                <Icon.Moon className="relative z-10 w-9 h-9 text-[#c7d2fe] animate-breathe" />
                            </div>
                        </button>
                    </div>
                    
                    {/* Текст */}
                    <p className="uppercase tracking-[0.4em] font-light animate-fade-in-up" style={{ color: '#EADDCD', fontSize: '11px', opacity: 0.5, animationDelay: '0.4s', animationFillMode: 'both' }}>
                        Выбери свою энергию
                    </p>
                </div>
            </div>
        );
        };

        const ScreenSphere = ({ onSelect, theme }) => (
            <div className="h-full flex flex-col pt-8 px-6 relative animate-fade-in-up">
                <div className="absolute inset-0 overflow-hidden pointer-events-none z-0">
                    <div className="absolute top-[-10%] left-[-10%] w-64 h-64 rounded-full mix-blend-screen filter blur-[80px] opacity-20 animate-breathe" style={{background: theme.accent, animationDuration: '8s'}}></div>
                    <div className="absolute bottom-[-10%] right-[-10%] w-64 h-64 rounded-full mix-blend-screen filter blur-[80px] opacity-10 animate-breathe" style={{background: theme.accent, animationDuration: '12s'}}></div>
                    <MagicalSparks />
                </div>

                <div className="mb-6 shrink-0 relative z-10 w-full max-w-[420px] mx-auto text-center">
                    <span style={{color: theme.accent}} className="text-[10px] tracking-[0.3em] uppercase block mb-2 font-bold text-center">ЭТАП 1 — ВЫБОР СФЕРЫ ЖИЗНИ</span>
                    <h2 style={{color: theme.text}} className="text-2xl leading-tight serif font-medium text-center text-balance">Выбери сферу жизни,<br/>в которой ты хочешь движения и улучшений</h2>
                    <p style={{color: theme.secondary}} className="text-xs mt-2 italic opacity-80 font-light text-center text-pretty">Без анализа. Выбирай интуитивно то, что сейчас важно.</p>
                </div>
                
                <div className="flex-1 overflow-y-auto scrollbar-hide pb-6 relative z-10 flex flex-col justify-center items-center w-full">
                    <div className="flex flex-col gap-3 w-full max-w-sm">
                        {SPHERES.map((sphere, i) => (
                            <button 
                                key={sphere.id} 
                                onClick={() => onSelect(sphere)}
                                className="glass-card w-full p-4 rounded-2xl border flex items-center gap-5 text-left group"
                                style={{ 
                                    background: theme.cardBg, 
                                    borderColor: theme.cardBorder,
                                    animationDelay: `${i * 0.1}s` 
                                }}
                            >
                                <div className="w-10 h-10 rounded-full flex items-center justify-center shrink-0 transition-all group-hover:scale-110 shadow-sm" style={{color: theme.accent, background: theme.mandalaBg}}>
                                    <sphere.icon className="w-5 h-5" />
                                </div>
                                <span style={{color: theme.text}} className="text-base serif font-medium flex-1 leading-tight">{sphere.title}</span>
                                <Icon.ArrowRight className="w-4 h-4 opacity-30 group-hover:translate-x-1 transition-transform" style={{color: theme.text}} />
                            </button>
                        ))}
                    </div>
                </div>
            </div>
        );

        const ScreenMandala = ({ sphereId, onSelect, onBack, theme }) => {
            const mandalasForSphere = getMandalasForSphere(sphereId);
            const displayMandalas = mandalasForSphere.map(id => STATES_DB[id]).filter(Boolean);

            // Разделяем 8 мандал на группы: 3 шт. - 2 шт. - 3 шт.
            const row1 = displayMandalas.slice(0, 3);
            const row2 = displayMandalas.slice(3, 5);
            const row3 = displayMandalas.slice(5, 8);
            const rows = [row1, row2, row3];
            
            const glowClass = theme.id === 'light' ? 'mandala-glow-light' : 'mandala-glow-dark';

            return (
                <div className="h-full flex flex-col pt-8 px-4 relative overflow-hidden">
                    <div className="absolute inset-0 overflow-hidden pointer-events-none z-0">
                        <MagicalSparks />
                    </div>
                
                    <button onClick={onBack} className="absolute top-4 left-4 p-2 rounded-full border transition-all hover:scale-110 active:scale-95 z-20 animate-fade-in-up" style={{borderColor: theme.cardBorder, color: theme.text, background: theme.cardBg}}>
                        <Icon.ArrowLeft className="w-5 h-5" />
                    </button>
                    
                    <div className="mb-4 shrink-0 text-center px-6 mt-4 relative z-10 animate-fade-in-up w-full max-w-[420px] mx-auto">
                        <span style={{color: theme.accent}} className="text-[10px] tracking-[0.3em] uppercase block mb-1 font-bold">ЭТАП 2 — ВЫБОР МАНДАЛЫ</span>
                        <h2 style={{color: theme.text}} className="text-xl leading-tight serif font-medium mb-1 text-balance">Посмотри на мандалы и выбери ту, которая откликается</h2>
                        <p style={{color: theme.secondary}} className="text-[11px] font-light uppercase tracking-widest mt-1 opacity-80">Доверься чувствам. Выбирай телом.</p>
                    </div>
                    
                    <div className="flex-1 flex flex-col items-center justify-center pb-6 w-full gap-4 relative z-10">
                        {rows.map((row, rIdx) => (
                            <div key={rIdx} className="flex justify-center items-center gap-4 w-full">
                                {row.map((m, i) => {
                                    const imgBaseName = m.img || m.id;
                                    const absoluteIndex = rIdx === 0 ? i : (rIdx === 1 ? i + 3 : i + 5);
                                    return (
                                        <div 
                                            key={m.id} 
                                            onClick={() => onSelect(m)} 
                                            className={`mandala-container group shadow-xl ${glowClass} animate-fade-in-up w-[26vw] h-[26vw] max-w-[105px] max-h-[105px] rounded-full shrink-0 flex items-center justify-center`}
                                            style={{ 
                                                animationDelay: `${absoluteIndex * 0.05}s`, 
                                                background: theme.id === 'dark' ? '#121217' : '#fff',
                                                animationFillMode: 'both'
                                            }}
                                        >
                                            <img 
                                                src={`./images/${imgBaseName}_${theme.id}.png`} 
                                                alt={m.title} 
                                                className="w-full h-full img-center-scale rounded-full" 
                                                onError={(e) => { 
                                                    const fallback = `./images/dignity_${theme.id}.png`;
                                                    if (e.target.src !== fallback) {
                                                        e.target.src = fallback;
                                                    } else {
                                                        e.target.style.display = 'none';
                                                    }
                                                }} 
                                            />
                                        </div>
                                    )
                                })}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const ScreenSync = ({ onComplete, theme }) => {
            const [text, setText] = useState("Сделай медленный вдох и выдох");
            useEffect(() => {
                const timer = setTimeout(onComplete, 5500);
                const interval = setInterval(() => setText(t => t.includes("вдох") ? "Позволь себе немного замедлиться" : "Сделай медленный вдох и выдох"), 2750);
                return () => { clearTimeout(timer); clearInterval(interval); };
            }, []);
            return (
                <div className="h-full flex flex-col items-center justify-center p-8 text-center animate-fade-in-up">
                    <div className="relative w-64 h-64 mb-16 flex items-center justify-center">
                        <div className="absolute inset-0 rounded-full opacity-20 animate-breathe" style={{background: theme.accent, filter: 'blur(40px)'}}></div>
                        <div className="absolute inset-10 rounded-full opacity-30 animate-breathe" style={{background: theme.accent, filter: 'blur(20px)', animationDelay: '0.5s'}}></div>
                        <Icon.Heart className="w-24 h-24 animate-breathe" style={{color: theme.text, fill: `${theme.accent}30`}} />
                    </div>
                    <h2 style={{color: theme.text}} className="text-2xl serif mb-3 tracking-widest uppercase font-medium">{text}</h2>
                    <p style={{color: theme.secondary}} className="text-sm font-light opacity-60">перед тем, как увидеть ответ.</p>
                </div>
            );
        };

        const ScreenResult = ({ sphere, mandala, theme, onRestart }) => {
            const description = CONTENT[sphere.id]?.[mandala.id] || "Текст формируется...";
            
            // Telegram Links
            const practiceMsg = encodeURIComponent(`Ксения, привет 🤍\nЯ прошла диагностику Fire of Life.\nМоя сфера: ${sphere.title}\nМоё состояние: ${mandala.title}\nХочу получить практику для пробуждения этого состояния.`);
            const practiceUrl = `https://t.me/kseniia_burakova?text=${practiceMsg}`;
            
            // Прямая ссылка на пост
            const buyUrl = mandala.link;
            const imgBaseName = mandala.img || mandala.id;

            return (
                <div key="result-screen" className="h-full w-full overflow-y-auto scrollbar-hide relative flex flex-col items-center">
                    <div className="flex flex-col items-center pt-8 pb-16 px-6 min-h-full text-center w-full max-w-[420px] mx-auto">
                        
                        <div className="animate-fade-in-up w-full text-center" style={{animationDelay: '0.1s', animationFillMode: 'both'}}>
                            <p style={{color: theme.secondary}} className="text-xs sm:text-sm tracking-[0.3em] uppercase mb-4 opacity-80 font-bold">Тебе не хватает сейчас</p>
                            <h2 style={{color: theme.accent}} className="text-5xl serif font-medium mb-10 drop-shadow-md text-balance">{mandala.title}</h2>
                        </div>
                        
                        {/* RESULT MANDALA (Анимация всплытия и увеличенного зума разделены для безупречной работы) */}
                        <div className="w-full flex justify-center items-center mb-10 animate-fade-in-up" style={{animationDelay: '0.2s', animationFillMode: 'both'}}>
                            <div 
                                className="relative w-[65vw] h-[65vw] max-w-[280px] max-h-[280px] shrink-0 shadow-2xl rounded-full border-4 overflow-hidden mx-auto flex items-center justify-center" 
                                style={{borderColor: `${theme.accent}30`, background: '#000'}}
                            >
                                 <img 
                                    src={`./images/${imgBaseName}_${theme.id}.png`} 
                                    className="w-full h-full object-cover object-center rounded-full animate-zoom" 
                                    onError={(e) => { 
                                        const fallback = `./images/dignity_${theme.id}.png`;
                                        if (e.target.src !== fallback) {
                                            e.target.src = fallback;
                                        }
                                    }} 
                                 />
                                 <div className="absolute inset-0 rounded-full shadow-[0_0_70px_rgba(212,175,55,0.25)] pointer-events-none"></div>
                            </div>
                        </div>

                        {/* DESCRIPTION BLOCK */}
                        <div className="w-full rounded-3xl p-8 mb-8 shadow-xl border text-center animate-fade-in-up" style={{background: theme.cardBg, borderColor: theme.cardBorder, animationDelay: '0.3s', animationFillMode: 'both'}}>
                            <p style={{color: theme.text}} className="text-base leading-relaxed opacity-90 mb-6 font-bold text-pretty">
                                {formatText(`Ты можешь много делать в сфере «${sphere.title.toLowerCase()}», но если внутри не хватает этого состояния, ощущение, что пазл не складывается.`)}
                            </p>
                            
                            <div className="text-base leading-relaxed font-normal opacity-90 space-y-4 text-center text-pretty" style={{color: theme.text}}>
                                {description.split('\n\n').map((line, i) => (
                                    <p key={i}>{formatText(line)}</p>
                                ))}
                            </div>
                        </div>

                        {/* PRODUCT BLOCK */}
                        <div className="w-full rounded-3xl p-8 mb-10 border flex flex-col items-center text-center gap-6 animate-fade-in-up" style={{background: theme.id==='light' ? '#fff' : 'rgba(255,255,255,0.03)', borderColor: theme.cardBorder, animationDelay: '0.4s', animationFillMode: 'both'}}>
                            <p style={{color: theme.text}} className="text-sm font-light leading-relaxed opacity-80 text-pretty">
                                {formatText("Аромат влияет на ту часть нас, которая минует логику и объяснения. Он помогает сначала пробудить это состояние, а затем закрепить его, чтобы ты могла возвращаться в него снова и снова.")}
                            </p>
                            
                            <div className="flex flex-col items-center gap-3 mt-2">
                                <div className="w-16 h-16 rounded-2xl flex items-center justify-center shrink-0 shadow-lg relative" style={{background: `${theme.accent}15`}}>
                                    <div className="absolute inset-0 rounded-2xl animate-pulse-glow" style={{background: theme.accent, filter: 'blur(12px)'}}></div>
                                    <Icon.Flame className="w-8 h-8 relative z-10" style={{color: theme.accent}} />
                                </div>
                                <div>
                                    <p style={{color: theme.secondary}} className="text-[10px] uppercase tracking-widest mb-1 opacity-70">Аромат-помощник</p>
                                    <h4 style={{color: theme.text}} className="serif text-xl font-bold">Свеча «{mandala.candle}»</h4>
                                </div>
                            </div>
                            
                            <a href={buyUrl} target="_blank" className="btn-primary mt-2 flex items-center justify-center gap-3 w-full py-5 rounded-2xl text-xs font-bold uppercase tracking-widest transition-all shadow-lg active:scale-95" style={{background: theme.accent, color: theme.buttonText}}>
                                <span>Пробудить состояние</span>
                                <Icon.ArrowRight className="w-4 h-4" />
                            </a>
                        </div>

                        {/* GIFT BLOCK */}
                        <div className="w-full rounded-3xl p-8 border-2 mb-12 animate-fade-in-up" style={{borderColor: theme.accent, background: `${theme.accent}08`, animationDelay: '0.5s', animationFillMode: 'both'}}>
                            <div className="flex items-center justify-center gap-3 mb-5">
                                <div className="relative w-16 h-16 flex items-center justify-center">
                                    <div className="absolute inset-0 rounded-full animate-pulse-glow" style={{background: theme.accent, filter: 'blur(12px)'}}></div>
                                    <Icon.Gift className="w-8 h-8 relative z-10" style={{color: theme.accent}} />
                                </div>
                            </div>
                            <h4 style={{color: theme.text}} className="text-xl serif font-bold uppercase tracking-wider mb-2">Мой подарок тебе</h4>
                            
                            <a href={practiceUrl} target="_blank" className="btn-primary mt-4 block w-full py-4 rounded-2xl text-center text-xs font-bold uppercase tracking-widest shadow-2xl transition-all active:scale-95 leading-relaxed" style={{background: theme.accent, color: theme.buttonText}}>
                                Получить глубокую<br/>расшифровку и&nbsp;практику
                            </a>
                        </div>
                        
                        {/* КНОПКА "НАЧАТЬ ЗАНОВО" */}
                        <button 
                            onClick={onRestart} 
                            className="mb-8 px-8 py-4 rounded-xl border transition-all flex items-center justify-center gap-3 text-[11px] uppercase tracking-[0.3em] animate-fade-in-up hover:scale-105 mx-auto shadow-md" 
                            style={{color: theme.text, borderColor: theme.cardBorder, background: theme.cardBg, animationDelay: '0.6s', animationFillMode: 'both'}}
                        >
                            <Icon.RotateCcw className="w-4 h-4" /> Начать заново
                        </button>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [step, setStep] = useState('intro');
            const [theme, setTheme] = useState(THEMES.dark);
            const [data, setData] = useState({ sphere: null, mandala: null });

            // ФОНОВАЯ ЗАГРУЗКА (ПРЕЛОАДЕР) КАРТИНОК
            useEffect(() => {
                const imagesToPreload = [
                    './images/logo.PNG',
                    './images/logo.png'
                ];
                
                Object.values(STATES_DB).forEach(state => {
                    const imgBase = state.img || state.id;
                    imagesToPreload.push(`./images/${imgBase}_light.png`);
                    imagesToPreload.push(`./images/${imgBase}_dark.png`);
                });
                
                imagesToPreload.forEach(src => {
                    const img = new Image();
                    img.src = src;
                });
            }, []);

            const handleTheme = (mode) => { setTheme(THEMES[mode]); setStep('sphere'); };
            const handleSphere = (s) => { setData(d => ({...d, sphere: s})); setStep('mandala'); };
            const handleMandala = (m) => { setData(d => ({...d, mandala: m})); setStep('sync'); };
            const handleRestart = () => { setStep('intro'); setData({ sphere: null, mandala: null }); };

            return (
                <div className="fixed inset-0 w-full h-full transition-colors duration-700 overflow-hidden" style={{background: theme.bgGradient}}>
                    <div className="w-full h-full max-w-md mx-auto relative shadow-2xl overflow-hidden" style={{background: theme.bg}}>
                        {step !== 'intro' && (
                            <div className="absolute top-0 left-0 h-1 z-50 transition-all duration-700" 
                                 style={{background: theme.accent, width: step==='sphere'?'33%':step==='mandala'?'66%':'100%'}}></div>
                        )}
                        {step === 'intro' && <ScreenIntro onSelectTheme={handleTheme} />}
                        {step === 'sphere' && <ScreenSphere onSelect={handleSphere} theme={theme} />}
                        {step === 'mandala' && <ScreenMandala sphereId={data.sphere?.id} onSelect={handleMandala} onBack={() => setStep('sphere')} theme={theme} />}
                        {step === 'sync' && <ScreenSync onComplete={() => setStep('result')} theme={theme} />}
                        {step === 'result' && <ScreenResult sphere={data.sphere} mandala={data.mandala} theme={theme} onRestart={handleRestart} />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
